// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {Test, console} from "forge-std/Test.sol";
import { ClaimNFT } from "../src/ClaimNFT.sol";
import { OGEthereum } from "../src/OGEthereum.sol";

contract ClaimNFTTest is Test {
    OGEthereum private nft;
    ClaimNFT private claimer;

    function setUp() public {
        // Deploy NFT contract
      nft = new OGEthereum();
      claimer = new ClaimNFT(nft, 0x6023974F44AE50635feEAaF9DEF6405f10299610, 5348475, 5387881);
      nft.grantRole(nft.CLAIMER_ROLE(), address(claimer));
    }

    function test_claimValidBlock() public {
      bytes memory firstL1BlockHeader = hex"f90262a0008e925525095f91b204fced2cab7b1eea69700103d45f28af29415c58bcf2b6a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794670b24610df99b1685aeac0dfd5307b92e0cf4d7a01b792693b17e2d5d6ef2e9e5f92ad9866295129c68659ac2f98f206e4f481fbda0fcd2144fffd82cf93292c2066034de2691676eefa645ff6930b3bd2b11cec9fca01323752d042eebe728bbca315ad34037f4f763149e515d5db7546a6554f23ac5b90100a99515cc44806089c40106043110059843225800467108f00396522e4e083808f40011a0e21e2485faa10ba0881444eb0710a0220bf367010d219804186c20005880c09a0117a0e85862d08a918045f180015914c4be565814050120c02a4212b868048902566b55b3c4400536946ad520808449e61803886268c01a0c5c5d0204c1444015128478a221d31b4a0918aa112070015aaeec045c6234a8bc4c31634e2c346a09e0008345d38481244407091444334520088e18647a09224282c11243c552630210480a8e823a23296525001111111610622e251608920870216019135090068d71003a0302685a0287080ca075b0115320074082110a54009d4aa0808351bdf38401c9c3808401c749aa8465da8f90964e65746865726d696e642d312e32352e345f74657374a0bbcd2613bf68505024c54a27635739a133eebd9599353b84942d3229385c7d2188000000000000000084116db0b5a050672302d9673d0347b9df8fc108c9506bc1b615f6b098a4c6a95e09892d91d8830c00008404b80000a0c6a5446616d7345d06c2eeabeed52644f1059ddb9aad4cb4cd10b4bc2120a2e4";
      bytes memory secondL1BlockHeader = hex"f90263a06c5bcdc375e004f2ad1ef8220196f9525c9aa797d0b91b0346a60aec373984c3a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347949b984d5a03980d8dc0a24506c968465424c81dbea0bd9f8740683e06d5f159904213153c3b7957f45b2db12f2159a60a13c5defc11a07584c63340e187d3163c28806e7e543f776d536f185e19e730a0c54151510977a0acb49321c257b8e45fc2d83b7a1d51f83790cd7889ae5458090c08353c8431b8b901002d00494fa900e4884099d603714205dce6ad588141114244a6124622d4e840d06148174780a00509a8a5115811950082248a001252f203cae5109001202885885400940b74ac89054688289a0c330403a409990695c040144a889100c087ee340b70c01902694a78b4d542200410cda66b0984e1158080227908badc80388614b2c29d8c8432fd24328535200a2c38e200120ca90100495d1501400026661c520208a24b8804e20a3850506b6058444008430204000408c46c9a04aa064050b202d6d0e2c3884000001241191e530104133200100862800c868098e0101467091270758e972b3942b2408000a0a5080c1a0960105a364cd1eb16860801e2d685808352355e8401c9c3808401089e408465e07eb099d883010d0e846765746888676f312e32312e37856c696e7578a0134bb0e299030670a75147d3ffe6909eb205469e38ed13bf7ceb5e1e82f2b7d888000000000000000085011444d9a7a044ea1e20ce398c5a0c6668688557a4194b6b69c598fd51a8941ce0fbbd8bc8f6808404c20000a0a20bb4932691befd6eb68c6bfd3801bfa37edfa56f592db2653a656f6f722962";

      bytes32 l3StateRoot = 0xcc091f8c17bc098dfdd95a5f20e2288a5de362d09a7e57f6c9161cb54f807558;

      bytes[] memory l3StateProof = new bytes[](6);
      l3StateProof[0] = hex"f90211a09f594023eebf28733fe9ea4c96e34bdf2e1bfe38b8bc563079d0df38bb683e33a05141229a3fe720589bc3df26f32b00bba73d8a8b6960687570152e02c3432daca0d460e998b595f7ef22229e79068e9c23594501434e6c0d159d0cfe022d763b47a03bec7de34b53a45867205093d9f4ef2773be7e10582de124d4c2ede5e86132cba0d7cd16e2cb1d5c32857f5b9e29ef51aeaecd694c514dc0547d1aba24fec1166ea016cf520e861cc37ca1d28d057fa8e0894eb0b0216889cf9404f090d6243df63da01a1bf7133d86a5d5052f4b14440b919230d6320829c6e31547b3a4be26fe9a76a0bb25918439d842493142b378d5de15758dec432764df3d8db5f9bf09f2ab1809a0600c4855bcb58f58d09ad3e98a0bd183fdfd05f414e8faf2b1e2138f27be87c8a0991c53b38f3a3a916fd9fa805622e0032ea8a8e96e73f60f1df4f9d5898d0979a02e331f27905217e4c10b9e291994935b9d092f2ddc4a9506627940f750f48417a0814d2a8a0ae29e86c6ce5256340e81a14a93d4faed59c9599f0099d9c25f0662a019299f2f65d8be87d2ad0f4b9170bc9177f29fca6f9d1b50b631e61d7ecbac28a0f04d6675b12618b5df973e7e603f614966777386a3148e6b886e3fd0b2ab4f62a0bf53e088492e590123130a261b792bde0e924a87ae803b62c86958ec172688a9a07be53c42578f9fced61297e73613b7a064688b2439b0bbcb5bb3a81266442e6b80";
      l3StateProof[1] = hex"f90211a03e4550c14454c7c93b75e023515794270766a90e54b655830a9845a2a2954fdda01c4e8e92daa6f41d43b26fd3e30155a886d3020928602d12292ba4987b7c5328a030fc49a5f892b577ca091b72bc667ac87d87c7d04d5159cd672bcf1aaf54827aa089588ccc0cc17fbc867e1f869dfd526fbb277e064b1b9edcfb252e9e5f60f15aa02565de8c024a2f8da0ec9fef54cf5b857f75ec8c33c3cb05fe1bda5ecc3cb331a0de431980544acd607ff1fbb809c283ac2fb6550f9fc258e4623084e3d2f4dbdda08c02cdb69c1af43511279457292d4f3b3abcbd197dd3ac647c3651a14d92a922a01ea8968940671112192a07f411542282c42f817d7fb98c042d66166ee33f09d1a0b4407b5f3adb124555081d3718b5280cf7aafccacd3831c78364af3382a7f0f1a042f451e2cf47aeb22c89bfac4cf53ba7954f047c1575a34f9bdbe379689f9efba08930e8e995fea5b03ce4557332deb74ececee93b3f86b8a33a88deee01ba01daa03771eaed1a9dd3216b3bb98f0d0513e00cd874a669d5e8ac9dba677821c93385a04ce7dc027305fdec5e1f012995c6a147245212ea91123cb4172630109a1f8d18a066ef289f3d51b781d98f3e29e14a65f3c0f157f5aba3181f5b8005d547dbf434a078297d902105ee98600fe127fa3eb6c0b445dca1b34cc0f36346e7ee93a9563ea0f7dcff2c8ec1520d97b02cebcec18123e35f054125d36aef9e6ad0084b3dc2be80";
      l3StateProof[2] = hex"f90211a0b6a60379b0604ccd190eca29ed86fe659089fab7065d1bc7c4ffde97a1bd96dba0f4fed89cb9f0f018f1f073f01d1f95c1e63bd60e463a64d303bf29eb60824036a06dae7221b58757df9bbe24055c2d154814673529bb197b2d577f2d93c952f02ca018b4bfc323ffc27adabe62e39ed4102f37a8056e1b078c4cba2e26e51f6f999ba036b22811ac423a4b351fda64ed99b3a958f9cac83249d40a38f2ee26051ed76da0ea98f9907ea47fb97fba99b8ea872fb450a78e24ce3e328c0a43cd336207f349a0329b726cc291aaffff2af5239f0f1a0984b173e093036e8738b894acea627905a044c8a1d0a04befb15f159b0dd06e634137a4a9db77446a9825de22280fd27b47a0cdfa81d3cd450e1467c84e303aa04564499afaacc20db9a22fdce4f774457471a07194439d9a8e101e509c8bcc4014d072f73ef4a87e2b69db0ce08b5dff40ea5ca069fb84d5d0cdea762314e52a53702ddb220c477f5b9d53553d12d8c77c52cca7a0de6b308f820f134bcb1a0cdc8d0f4bde2d56a4df4b010ba2e838c2fe1a1ea2a9a0bbc3513308636c784d315925b111809b46ee9ea54a3eceaa0c83503e5f312c1ea0ac183c246294aade15faca7710bed5794e8eb46f7f59b8eab3c2c24aedfa67fba0cafc4a5bffdc65147901d03dd67ca82f69d63670a00c39386db3a8a8f5f4bbd5a07072629b2a27b6440f72db99961c7eeda53a5d3318b43152c6eff24971152c7080";
      l3StateProof[3] = hex"f901f1a0b2a5494347d167ac6b318fddafad6cf37b09968e832dc45ceda5b0641475feb9a026099f355ad966579c4f3f9c417b0c0fee3053bc8caea49718961096434935faa0d4b26ccd4ea883edad46792967b6d7408e6dbd73948f1e77c5741f50edbda39da062ace5d5558c8298816e11af7ca935661fb0d0e24c26dcd0c4027ac4699f8ceba0b29981c6c804e47510a9642a01d9c6cfbaeb0220fa72d0ed0123bcfb8d9f8cbda0a02d3675d8039723a0f9ca22a5321b65c867e4aa66a9aa1274e59e5d4c0f4ac3a065e585ad075eb2d7f6e0c1badfdbd79b2b73a6ce6fdd2c33bd8ce17fc98e9ab4a094393361132f4b603b25d34bdf6047d0839a2c062e2c6eeac179d7744cab9fafa0b95a8490d16b61ac8b7307437872e85a546ccf701d42d67563cf8654aba2b4b7a0bcc46c2f04828b54bbe9e871c3a319e2a1c06af371cc79923aebd124202f4df580a0c4aec3f0d020aa119ff2ced54596688b444284e8d09b623008a84b282b93e1b3a02a3167175c9dd19e0ebca38558cb6e0dfc6e3867069ccff6d8898b499a07af19a0e3d466a981743e525be3ba8424a60e7798ec1e468e2989bdaada5ce29ccff72da0651af45a8ab7ef25cfff858d74e77c44177ec839e62f7c0a5374d1725f86a155a029127e23c22849e9340198fe04298eaf6683b77ace56f26d6a1e5b6bbed3d8d780";
      l3StateProof[4] = hex"f89180808080808080a07a6ab4f1b2aed43f24ca1f33ee2898f9aecd4ef37ce62ef5256cfb9395845537a07b667927a966742e64576b602692626d245da24fac4fc918182248fc235dc95680a0aa02aa104ae48a220fb26a0397b0b22a0c980600e0af03a9fa917947deb411dd80a04460999d3160130a733a60f47b784a60f55107c9b561c2e2fe2bfef4eac7a64080808080";
      l3StateProof[5] = hex"f8679e39b91fcc363aa5511f5844555288b55cf8f27b6d6c72133618a2e48e313eb846f8440180a07b1c40c8bd4190dc80bdf9dc42977dd7774bed2b477f92d860a5bf0f83a890b0a0362ceb387e472af10fb0d425ba468e21ef584867e8f75b2b81e6d9073d5239a8";

      bytes[] memory firstHistoryProverStorageProof = new bytes[](2);
      firstHistoryProverStorageProof[0] = hex"f871a0e9c1f4c6dbe1c3017e690c1b1b31a3a973f74668b91b088b7d1ed4c90c3c0c3b808080808080a0bd75abed47c19f2601f0273d7dd9c4ee3e9a09bd8709a0d05f2bc2b0a838594180808080808080a0f6c110b60f6a2b281498f8906b87f2e418e138f7dbe02eeadfc50890af8d0c2280";
      firstHistoryProverStorageProof[1] = hex"f843a039d11ea85003388f5c2ee74314fd6dde94a801ccd54b5f617e1d68bbab6ce8f6a1a073646fba8d16801b16e94aa7a89d4e21db95e03537317b3a378b34cacda0ebde";

      bytes[] memory secondHistoryProverStorageProof = new bytes[](2);
      secondHistoryProverStorageProof[0] = hex"f871a0e9c1f4c6dbe1c3017e690c1b1b31a3a973f74668b91b088b7d1ed4c90c3c0c3b808080808080a0bd75abed47c19f2601f0273d7dd9c4ee3e9a09bd8709a0d05f2bc2b0a838594180808080808080a0f6c110b60f6a2b281498f8906b87f2e418e138f7dbe02eeadfc50890af8d0c2280";
      secondHistoryProverStorageProof[1] = hex"f843a03b4b9bb0af9b99d7b8028db056dcb29a6728042ae29ccc2fc6122621221b4139a1a08746dda7b30f931685d8404113d79899ae68ed285b2632dc94a64938b0025c09";

      bytes[] memory firstTxProof = new bytes[](5);
      firstTxProof[0] = hex"f90131a0d62719ff7e923423a545d4368b071c541580ca4a3709e00601c7aed66503ce8ea01a5d00125c2f5e79c9661902d590275fc9781731ab114f3086fe6398868e81fea09abac53e3b396c7d6e4d10ba7357ac491e31cb60bd0943e44d16c84b604a6c67a021942a5e34c35df5e2d2f647714dbb15b5db03af62a17c9799c697d8472b5d0fa0476963cfb6016f112a7db7ad8bc9c11de82cd558e1c66ffd8c52645dec2ac1bca072ae524681634edd8d44291f3e988f304a781cc8287eb205662a4212f28e3fcda0d8e2df27b1f1a18b72c9e372aec6ab50f9804dfa52e7916224b9a6a47ced25b8a0075ca8dd9ece0d9238275fcd589455bde04518454d5bdc791cd193edcd94a5e5a0933d9996c59553aef7f98cc79fd344d0a4b5606a2f8b31b3a3542d1c44ae1fcb8080808080808080";
      firstTxProof[1] = hex"f851a0e20c474c9bb712b499ff021e309515ba528e79d13e5731a495a32ffc41c736e1a05bac2f64f49a779fbadb64c76c10b9d95b8e315f0ac37d969a9809979c86951e808080808080808080808080808080";
      firstTxProof[2] = hex"f8f18080808080808080a09c5a2f36b6a5ff85e94884d44284740cb12f53b97a3e15cd39594a19bbd65019a0a1f4cb26b68a0bda3c3776eb9233dd8594a8d7d8623dd6bae2236ac70ea842aaa028a242451c1f7bf5e95f82fcb083c3e4f68006633d19e291378ec23801aab1a0a03c2f9608738b74f899d046da813513212a4ee33590ebc4e0065b8d314f9f81d8a02e219341166f659703ce6f84badbfc76625f9c4b5865fc5abd2c19736d6c62c6a0a0a24465ae3a90212c72a740d9a6e1ab32d75b2bfbd17b14e8e167a0f921af8ca049fdf78bf4d91d5a696931f7188ab443249dd9bf99198e0197d4798bc4229a8e8080";
      firstTxProof[3] = hex"f90211a05c80bb49cd7139eba442205d550aec2e342e8061ed368bd3d896b18667a6827da046d9efc75a462d63f9a89ccfa6b4b9ac924ce298eb883c50626fa374c14e5704a0774470b22ccf5cdb0cb9ff32295a602234501259f544cb8f4e2fcad3291da537a078b8a56bb32fef56d5ef7d8d8b1cb6385b2cb34e21697166d3849414562adc7ca075d949f80e834883dbffbcd2c70e1062823a6f4300242429e5fdbea1b8dc35d0a0a2d8cddde8ab13d15f2a989b2f42921f280efa394d2b421fe4e4ed5f1794d8bca0bf4389d4d9aabeca786a9808a99250ec17c5a6ab7bac0e9412dc3e55b42529bca01281957c5ced980408a935160726b7abb01c448645435e7c7cc25866d59ee0c4a01e5b2a29bb4770e7198cf35206fb63851a5789b2835cab3043d48302036043d6a094e45d498eefb2334dcf25e555c93f6750f7695ce87406c47ce3529b7eb7f6aaa06b0501216ffb66952540c5c4970e06df3c4f68f59c5b6aa0ba227e825f5083eca06cb18407d0bf60c69f4d9a1986942250e0ab330e71fd8ce961a6e4cce0d35caea04b528219932e9e7d048468c642c65721a5c0800ccf36fe2e56924b4a207d4275a06c9af608e4acedf3c22bec6a69244c85446a8ef9bab92197b006837244f54944a035f4ec0131c059c8bfbd1fef94948ec4e55ac5ecce246d04d0c57479b2202e83a03e08a3765e135919d7d54bb4fa2f3e88d91066afcfedab72ed3230005b07099380";
      firstTxProof[4] = hex"f88020b87d02f87a83aa36a7108459682f00847369780a83017e1c94aae29b0366299461418f5324a79afc425be5ae21881bc16d674ec8000084439370b1c001a09b7e391bb98455eaf0a144199c9580d30eae8adbe423608f7f4d1aa43791d233a004b489bf8f4e559fc8d5527dc577fce44f415027f2f086e7cdcd0a55e0a16808";

      bytes[] memory secondTxProof = new bytes[](3);
      secondTxProof[0] = hex"f90131a08d62c06c328a22f07c4efd8e140b43e6a8543fb7f8a6beb1c57e4da0b4bbacdfa068aa2d6342be191dfd15b213a5afa5d116f1c014b1f65b2c47344337466ff4afa04c4923e8496172ba4d2e0f6cfccd1f9d1fdbff4152b2e4a66123ebb73f5047dda0e743ebd8bea89b99b31915f3ce4af25b7eef165a5c3f5525d02fb93a13d39c63a0a2177c7f46ae5628ba37c018fc9b788b1be406f967d176b5f467aa15cf1e0887a09005b5ee3d57758e84e02bfb39022c47ffe9bcfadd33b36e86890ebdc08c6126a08756ea032e5127ac050186ccf3d442d7812b7e68895c58fde04fbcf59c275731a0118ec59e64f6abb87160f5c2e711c4d34b65279c57b581f728cf5f41fbf9f404a06aafdba22318b4f2c0ca7942dca7bb933ee6efa2d3a3b2b22bfc3638f86801818080808080808080";
      secondTxProof[1] = hex"f90211a0446747b31d6e61cac53bfdd1b7fd1c89c91c9c6c401b020e7157498f2229f4fea0ce20a13225b1ad9612c8c4aa23ea681516fefb136a92289b18009505728d29dba00857f2d04150ea0398352a9fd4929369ae760b89ceaf52c06a0d6853b38ee284a034afac244e956da01f27539ae2a4be49a81a59f105535ac238dc11b2ec678ec4a09aed3a41688157d24433616ee0f26e4af6265067de89325cd19a290fc3d378c8a00266376e0270453ca29c0c9558e2b657c59c3102afbf64631a208484628dcbb2a0b0492a7204e0ad69b8fbae63062b1f4d53b8fa13eb7caacea22a64f5c24020d8a038f13bc06a171c18b2737f820febba974365f4e43267f9bffe7c54fcd3744219a03b9ea77eac13002863bcb6db6d00090289d07a8065900407ac935a5a4b7b9f52a0911e1e31838bba7cf0222fa8cddb1b2f31d36e6727df387cfdc5f07dc54f4a58a038e56b695ec06ee7a3baee2a637456c91cd95ea50274976326a249d70b3c6ea5a03ce6e041f98550ec893e4ed03c52666373b1d097938bc878caa3f8c58f69320ea050a35ad190dac1ebb1515f1f9ad1ec2b2dc30733f6d1ae28daf8e7a5b278af5fa0c348e5711554174177497987e122d4dda91deeb3cdff6f3e2841c58bb2df9440a01c03e37cf2940949d83071f74cb318d42c476f9409ab1b79420e321e275bd37fa08743807328b3b19919b39171e72dfc4d2b0f6028b86f2c573f4f936dd6acb47280";
      secondTxProof[2] = hex"f87420b87102f86e83aa36a7118459682f008501b004280a82520894f3c9cfc9a3f53b36158e06ab4186965019f76bde8080c080a00aa8f6083670de552726a1734eadc561b983247a8fdcfe700804a2a679b3fcdfa079c2583a08483bac2a84a13a70eb05fe3fd112a2f389b9bfc6bfea2cccefdc19";

      bytes memory firstTxIndex = hex"819e";
      bytes memory secondTxIndex = hex"72";

      ClaimNFT.TxProof memory first = ClaimNFT.TxProof({
        l1BlockHeader: firstL1BlockHeader,
        txIndex: firstTxIndex,
        historyContractStorageProof: firstHistoryProverStorageProof,
        txProof: firstTxProof
      });

      ClaimNFT.TxProof memory second = ClaimNFT.TxProof({
        l1BlockHeader: secondL1BlockHeader,
        txIndex: secondTxIndex,
        historyContractStorageProof: secondHistoryProverStorageProof,
        txProof: secondTxProof
      });

      address oldOwner = nft.ownerOf(0);

      address prover = address(0x0078C86e12186E2dE1Ff6fef5F1aDa2BffDe4eA5);

      vm.prank(prover);
      claimer.claim(
        l3StateRoot,
        l3StateProof,
        first,
        second
      );

      address newOwner = nft.ownerOf(0);

      assertEq(oldOwner, address(nft));
      assertEq(newOwner, address(prover));
    }
}
